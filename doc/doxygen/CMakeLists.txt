SET(DOXYGEN_LAYOUT ${CMAKE_CURRENT_SOURCE_DIR}/DoxygenLayout.xml)
SET(DOXYGEN_IMAGES ${CMAKE_CURRENT_SOURCE_DIR})
SET(MARKDOWN_DOCS ${CMAKE_SOURCE_DIR}/doc/md)

MACRO(GENERATE_DOXYGEN_HTML CONFIG PAGES HTML_OUTPUT_DIR)
	SET(DOXYGEN_PAGES "${CMAKE_CURRENT_SOURCE_DIR}/${PAGES}")
	SET(DOXYGEN_OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/${HTML_OUTPUT_DIR}/index.html")
	SET(DOXYGEN_HTML_OUTPUT_DIR ${HTML_OUTPUT_DIR})
	STRING(REGEX REPLACE "([a-zA-Z_]*).in" "${CMAKE_CURRENT_BINARY_DIR}/\\1" DOXYGEN_GENERATED_CONFIG "${CONFIG}")

	configure_file("${CMAKE_CURRENT_SOURCE_DIR}/${CONFIG}"
		${DOXYGEN_GENERATED_CONFIG} @ONLY)

	add_custom_command(OUTPUT ${DOXYGEN_OUTPUT}
		COMMAND ${DOXYGEN_EXECUTABLE} ${DOXYGEN_GENERATED_CONFIG}
		DEPENDS ${DOXYGEN_GENERATED_CONFIG}
		COMMENT "Generating ${DOXYGEN_HTML_OUTPUT_DIR} documentation"
	)
	LIST(APPEND DOXYGEN_DEPENDENCIES ${DOXYGEN_OUTPUT})
ENDMACRO()

GENERATE_DOXYGEN_HTML(Doxyfile_en.in pages html)

add_custom_target(doxygen DEPENDS ${DOXYGEN_DEPENDENCIES})
